<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projetos | César Malaguti</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/admin.css" />
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <a href="index.html">César Malaguti</a>
      </div>
      <nav>
        <ul>
          <li><a href="index.html">Sobre</a></li>
          <li><a href="publications.html">Publicações</a></li>
          <li><a href="projects.html" class="active">Projetos</a></li>
          <li><a href="experience.html">Experiência</a></li>
          <li><a href="education.html">Formação</a></li>
          <li><a href="contact.html">Contato</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="projects">
      <div class="container">
        <h1 class="editable" data-lang="pt">Projetos</h1>
        <h1 class="editable" data-lang="en" style="display:none;">Projects</h1>

        <div id="project-list">Carregando projetos...</div>

        <!-- Admin Panel -->
        <div id="admin-panel" style="display:none; margin-top:2rem;">
          <h3>Adicionar Projeto</h3>
          <input type="text" id="new-project-name" placeholder="Nome do projeto" />
          <textarea id="new-project-description" placeholder="Descrição do projeto"></textarea>
          <button onclick="addProject()">Salvar</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p data-lang="pt">&copy; 2025 César Malaguti. Todos os direitos reservados.</p>
      <p data-lang="en" style="display:none;">&copy; 2025 César Malaguti. All rights reserved.</p>
    </div>
  </footer>

  <script>
    const API_URL = "https://cesarmalaguti-site-backend.onrender.com";
    const projectList = document.getElementById("project-list");

    let projects = [];

    function renderProjects() {
      if (projects.length === 0) {
        projectList.innerHTML = "<p>Nenhum projeto cadastrado ainda.</p>";
        return;
      }

      const html = projects.map((project, index) => `
        <div class="project-item">
          <input value="${project.name}" onchange="updateField(${index}, 'name', this.value)" />
          <textarea onchange="updateField(${index}, 'description', this.value)">${project.description || ""}</textarea>
          <button onclick="saveProject(${index})">Salvar</button>
          <button onclick="deleteProject(${index})">Excluir</button>
        </div>
      `).join("");

      projectList.innerHTML = html;
    }

    function loadProjects() {
      fetch(`${API_URL}/projects`)
        .then(res => res.json())
        .then(data => {
          projects = data;
          renderProjects();
        })
        .catch(() => {
          projectList.innerHTML = "<p>Erro ao carregar projetos.</p>";
        });
    }

    function updateField(index, field, value) {
      projects[index][field] = value;
    }

    function saveProject(index) {
      fetch(`${API_URL}/projects/${index}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(projects[index])
      })
        .then(res => res.json())
        .then(() => {
          alert("Projeto salvo!");
          loadProjects();
        });
    }

    function deleteProject(index) {
      if (!confirm("Tem certeza que deseja excluir este projeto?")) return;

      fetch(`${API_URL}/projects/${index}`, {
        method: "DELETE"
      })
        .then(res => res.json())
        .then(() => {
          alert("Projeto excluído!");
          loadProjects();
        });
    }

    function addProject() {
      const name = document.getElementById("new-project-name").value.trim();
      const description = document.getElementById("new-project-description").value.trim();

      if (!name || !description) {
        alert("Preencha todos os campos.");
        return;
      }

      fetch(`${API_URL}/projects`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, description })
      })
        .then(res => res.json())
        .then(() => {
          alert("Projeto adicionado!");
          document.getElementById("new-project-name").value = "";
          document.getElementById("new-project-description").value = "";
          loadProjects();
        });
    }

    if (localStorage.getItem("admin") === "true") {
      document.getElementById("admin-panel").style.display = "block";
    }

    loadProjects();
  </script>





